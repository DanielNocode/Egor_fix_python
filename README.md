# –ó–∞–¥–∞—á–∞: –§–∏–∫—Å Telethon-–≤–µ–±—Ö—É–∫–æ–≤ –ï–≥–æ—Ä–∞ + –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–¥–∞—à–±–æ—Ä–¥

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ù–∞ VPS (`root@wfoxxidthq`) —Ä–∞–±–æ—Ç–∞—é—Ç –¥–≤–∞ Flask+Telethon –≤–µ–±—Ö—É–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram. –û–±–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –ï–≥–æ—Ä—É (Rumyantsev). –°–µ—Ä–≤–∏—Å—ã –∫—Ä—É—Ç—è—Ç—Å—è —á–µ—Ä–µ–∑ systemd + gunicorn —Å gevent –≤–æ—Ä–∫–µ—Ä–æ–º.

**–°–µ—Ä–≤–∏—Å—ã:**
- `send-media-rumyantsev.service` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–¥–∏–∞/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ø–æ—Ä—Ç **5023**)
- `send-text-rumyantsev.service` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤ (–ø–æ—Ä—Ç **5022**)

**–§–∞–π–ª—ã —Å–∫—Ä–∏–ø—Ç–æ–≤:**
- `/root/send_media_rumyantsev_webhook.py`
- `/root/send_text_rumyantsev_webhook.py`

**–ë—ç–∫–∞–ø—ã (—Å–¥–µ–ª–∞–Ω—ã –î–∞–Ω–∏–∏–ª–æ–º 13.02):**
- `/root/send_media_rumyantsev_webhook.py.bak.20260213`
- `/root/send_text_rumyantsev_webhook.py.bak.20260213`

**Systemd-—é–Ω–∏—Ç—ã:**
- `/etc/systemd/system/send-media-rumyantsev.service`
- `/etc/systemd/system/send-text-rumyantsev.service`

**–û–∫—Ä—É–∂–µ–Ω–∏–µ:** `/root/telethon_env/` (Python venv —Å telethon, flask, gunicorn, gevent)

**Telegram API credentials (–æ–±—â–∏–µ –¥–ª—è –æ–±–æ–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤):**
- API_ID: `36091011`
- API_HASH: `72fa475b3b4f5124b9f165672dca423b`
- –°–µ—Å—Å–∏–∏: `rumuantsev_media` –∏ `rumyantsev_send_text` (–≤ `/root/`)

---

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (20.02.2026)

### –°–∏–º–ø—Ç–æ–º—ã
–ï–≥–æ—Ä —Å–æ–æ–±—â–∏–ª: "–æ—Ç—Ä—ã–≥ –≤–æ–æ–±—â–µ –∫–∞–ø–∏—Ç–∞–ª—å–Ω—ã–π, –Ω–∏—Ö—É—è –Ω–µ –ø–∞—à–µ—Ç". –û–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 500-–∫–∏ –Ω–∞ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã.

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (–∏–∑ journalctl)

**1. –ë–∞–Ω –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ:**
```
06:52:33 Account is now banned in 3760957276 so we can no longer fetch updates from it
```
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ—Å—ã–ø–∞–ª–∏—Å—å –º–∞—Å—Å–æ–≤—ã–µ –æ—à–∏–±–∫–∏ resolve entity.

**2. PersistentTimestampOutdatedError (–æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞, –≤–µ—Å—å –¥–µ–Ω—å):**
```
WARNING: Telegram is having internal issues PersistentTimestampOutdatedError:
Persistent timestamp outdated (caused by GetChannelDifferenceRequest)
```
–¢–µ–ª–µ—Ç–æ–Ω –ø—ã—Ç–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤ ‚Äî Telegram –µ–≥–æ –æ—Ç–±–∏–≤–∞–µ—Ç.

**3. –ù–µ –º–æ–∂–µ—Ç –∑–∞—Ä–µ–∑–æ–ª–≤–∏—Ç—å —á–∞—Ç—ã –ø–æ ID (send_media):**
```
ERROR: send_media failed: ValueError: Cannot resolve entity from user_id=-1003833950795.
Make sure this session has an existing dialog with the user/channel, or use 'username'.
```
–î–µ—Å—è—Ç–∫–∏ —Ä–∞–∑–Ω—ã—Ö chat_id –Ω–µ —Ä–µ–∑–æ–ª–≤—è—Ç—Å—è.

**4. –ù–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —á–∞—Ç—ã –≤ –¥–∏–∞–ª–æ–≥–∞—Ö (send_text):**
```
ERROR: send_text failed: ValueError: –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç -1003790384176 –≤ –¥–∏–∞–ª–æ–≥–∞—Ö
```
12+ —á–∞—Ç–æ–≤ –ø–æ–¥—Ä—è–¥ –≤ 07:00, –ø–æ—Ç–æ–º –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ—Å—å –≤–µ—Å—å –¥–µ–Ω—å.

**5. Flood wait –Ω–∞ GetDialogsRequest (send_media):**
```
INFO: Sleeping for 26s (0:00:26) on GetDialogsRequest flood wait
```
–¢–µ–ª–µ–≥—Ä–∞–º –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –¥–∏–∞–ª–æ–≥–æ–≤. –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π: –Ω–µ –Ω–∞—à—ë–ª entity ‚Üí –ø–µ—Ä–µ–∑–∞–ø—Ä–æ—Å –¥–∏–∞–ª–æ–≥–æ–≤ ‚Üí flood wait ‚Üí –Ω–µ –Ω–∞—à—ë–ª ‚Üí —Å–Ω–æ–≤–∞...

### –ü–µ—Ä–≤–æ–ø—Ä–∏—á–∏–Ω—ã

1. **–î–≤–∞ Telethon-–∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç** ‚Äî –æ–±–∞ —Å–∫—Ä–∏–ø—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω API_ID, –Ω–æ —Ä–∞–∑–Ω—ã–µ —Å–µ—Å—Å–∏–∏. –≠—Ç–æ –¥–≤–æ–π–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞, –æ–±–∞ –¥—ë—Ä–≥–∞—é—Ç GetDialogs –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

2. **Flood wait loop –≤ send_media** ‚Äî –≤ `resolve_entity_by_id()` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–æ–º–∞—Ö–µ –∫—ç—à–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `_warmup_dialog_cache()` ‚Üí `iter_dialogs()` ‚Üí flood wait ‚Üí –ø—É—Å—Ç–æ–π –∫—ç—à ‚Üí –ø—Ä–æ–º–∞—Ö ‚Üí —Å–Ω–æ–≤–∞ warmup. –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª.

3. **send_text –≤–æ–æ–±—â–µ –Ω–µ –ø—Ä–æ–≥—Ä–µ–≤–∞–µ—Ç –∫—ç—à –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ** ‚Äî –Ω–µ—Ç `_warmup_dialog_cache()` –≤ `telethon_thread()`. –†–µ–∑–æ–ª–≤–∏—Ç —á–µ—Ä–µ–∑ `iter_dialogs(limit=200)` –≤ `_get_chat_entity()` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–æ–º–∞—Ö–µ ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, flood wait.

4. **Retry-–ª–æ–≥–∏–∫–∞ –Ω–µ –ª–æ–≤–∏—Ç ValueError** ‚Äî –î–∞–Ω–∏–∏–ª –¥–æ–±–∞–≤–∏–ª retry –¥–ª—è `PersistentTimestampOutdatedError` –∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫, –Ω–æ `ValueError: Cannot resolve entity` –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ `RETRIABLE_ERRORS` –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è PersistentTimestamp ‚Äî –ø–æ—ç—Ç–æ–º—É —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 500 –±–µ–∑ retry.

---

## –ß–∞—Å—Ç—å 1: –§–∏–∫—Å —Å–∫—Ä–∏–ø—Ç–æ–≤

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

#### 1.1. send_media (`/root/send_media_rumyantsev_webhook.py`)

**–ü—Ä–æ–±–ª–µ–º–∞ A ‚Äî Flood wait loop:**
–í —Ñ—É–Ω–∫—Ü–∏–∏ `resolve_entity_by_id()` (–ø—Ä–∏–º–µ—Ä–Ω–æ —Å—Ç—Ä–æ–∫–∞ 120-140) –µ—Å—Ç—å –∫–æ–¥:
```python
# –ü–æ—Å–ª–µ–¥–Ω–∏–π fallback ‚Äî –ø–µ—Ä–µ–ø—Ä–æ–≥—Ä–µ–≤ –≤—Å–µ–≥–æ –∫—ç—à–∞
await _warmup_dialog_cache(client)
ent = _DIALOGS_BY_ID.get(int(uid))
if ent is not None:
    return ent
```
–≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç `iter_dialogs()` –ø—Ä–∏ –ö–ê–ñ–î–û–ú –ø—Ä–æ–º–∞—Ö–µ –∫—ç—à–∞ ‚Üí flood wait –æ—Ç Telegram.

**–§–∏–∫—Å:** –£–±—Ä–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π `_warmup_dialog_cache` –∏–∑ `resolve_entity_by_id`. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å warning –∏ —Å—Ä–∞–∑—É –∫–∏–¥–∞—Ç—å –æ—à–∏–±–∫—É. –ö—ç—à –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≥—Ä–µ–≤–∞—Ç—å—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.

**–ü—Ä–æ–±–ª–µ–º–∞ B ‚Äî –ù–µ—Ç catch_up=False:**
–í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞–ø–∏—Å–∞–Ω–æ "catch_up=False –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ", –Ω–æ –≤ –∫–æ–¥–µ `_telethon_loop()`:
```python
_client = TelegramClient(SESSION_PATH, API_ID, API_HASH)
started = _client.start()
```
–ù–∏–≥–¥–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è `catch_up=False`. –ù—É–∂–Ω–æ:
```python
_client = TelegramClient(SESSION_PATH, API_ID, API_HASH, catch_up=False)
```
–ò–ª–∏ –ø—Ä–∏ `client.start()` ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏ Telethon.

#### 1.2. send_text (`/root/send_text_rumyantsev_webhook.py`)

**–ü—Ä–æ–±–ª–µ–º–∞ A ‚Äî –ù–µ—Ç –ø—Ä–æ–≥—Ä–µ–≤–∞ –∫—ç—à–∞:**
–í `telethon_thread()` –Ω–µ—Ç –≤—ã–∑–æ–≤–∞ `_warmup_dialog_cache()`. –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–æ–¥–∏–Ω —Ä–∞–∑).

–ù–æ —É send_text –Ω–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `_warmup_dialog_cache` ‚Äî –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É:
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ: –æ–¥–∏–Ω —Ä–∞–∑ `iter_dialogs()` ‚Üí –∑–∞–ø–æ–ª–Ω–∏—Ç—å `_DIALOGS_BY_ID`
- –í `_get_chat_entity()`: —Å–Ω–∞—á–∞–ª–∞ –∏—Å–∫–∞—Ç—å –≤ –∫—ç—à–µ, –ø–æ—Ç–æ–º `get_entity()`, –∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º –Ω–µ –Ω–∞—à–ª–∏ ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É (–ù–ï –¥–µ–ª–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π `iter_dialogs`)

**–ü—Ä–æ–±–ª–µ–º–∞ B ‚Äî iter_dialogs –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–æ–º–∞—Ö–µ:**
–í `_get_chat_entity()`:
```python
async for dialog in client.iter_dialogs(limit=200):
```
–≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–æ–º–∞—Ö–µ `get_entity()` ‚Üí flood wait.

**–§–∏–∫—Å:** –ò—Å–∫–∞—Ç—å –≤ –ø—Ä–æ–≥—Ä–µ—Ç–æ–º –∫—ç—à–µ –≤–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ `iter_dialogs`.

**–ü—Ä–æ–±–ª–µ–º–∞ C ‚Äî –ù–µ—Ç catch_up=False:**
–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ send_media.

#### 1.3. –û–±—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ–±–æ–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤

- –î–æ–±–∞–≤–∏—Ç—å **–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞** (—Ä–∞–∑ –≤ 30 –º–∏–Ω—É—Ç, —á–µ—Ä–µ–∑ asyncio loop) –≤–º–µ—Å—Ç–æ –ø—Ä–æ–≥—Ä–µ–≤–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—Ä–æ–º–∞—Ö–µ
- –î–æ–±–∞–≤–∏—Ç—å **endpoint `/reload_cache`** –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ–≤–∞ (–ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞)
- –î–æ–±–∞–≤–∏—Ç—å **endpoint `/stats`** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–ø–∏—Å–µ–π –≤ –∫—ç—à–µ, uptime, —Å—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫, –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –æ—à–∏–±–æ–∫

### –í–∞–∂–Ω–æ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

- –°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –ø—Ä–∞–≤–∫–∞–º–∏: `cp file.py file.py.bak.20260220`
- –ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫: `sudo systemctl restart send-media-rumyantsev && sudo systemctl restart send-text-rumyantsev`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `journalctl -u send-media-rumyantsev --since "1 min ago" --no-pager`
- –ú–µ–∂–¥—É —Ä–µ—Å—Ç–∞—Ä—Ç–∞–º–∏ –¥–≤—É—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ–¥–æ–∂–¥–∞—Ç—å 30-60 —Å–µ–∫—É–Ω–¥ (–æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç, flood wait)

---

## –ß–∞—Å—Ç—å 2: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–¥–∞—à–±–æ—Ä–¥

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–°–æ–∑–¥–∞—Ç—å –≤–µ–±-–¥–∞—à–±–æ—Ä–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telethon-—Å–µ—Ä–≤–∏—Å–∞–º–∏. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π systemd-—Å–µ—Ä–≤–∏—Å.

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend:** Python (Flask –∏–ª–∏ FastAPI)
- **Frontend:** HTML + CSS + JS (single page, –±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ)
- **–°—Ç–∏–ª—å:** –¢—ë–º–Ω–∞—è —Ç–µ–º–∞, –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π, —É–¥–æ–±–Ω—ã–µ –∫–Ω–æ–ø–∫–∏

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–∞—à–±–æ—Ä–¥–∞

#### 2.1. –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤ (–≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω)
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ –¥–≤—É—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
- **–°—Ç–∞—Ç—É—Å**: üü¢ running / üî¥ stopped / üü° restarting (–¥–∞–Ω–Ω—ã–µ –∏–∑ `systemctl status`)
- **Uptime**: —Å–∫–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **Memory / CPU**: —Ç–µ–∫—É—â–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ
- **–ü–æ—Ä—Ç**: 5022 / 5023
- **–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å**: –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –ø—Ä–∏—à—ë–ª –∑–∞–ø—Ä–æ—Å (–∏–∑ /stats endpoint —Å–∫—Ä–∏–ø—Ç–æ–≤)
- **–†–∞–∑–º–µ—Ä –∫—ç—à–∞**: —Å–∫–æ–ª—å–∫–æ entity –≤ –∫—ç—à–µ –¥–∏–∞–ª–æ–≥–æ–≤

#### 2.2. –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ (–ª–µ–Ω—Ç–∞)
- –ü–∞—Ä—Å–∏—Ç—å `journalctl` –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ (ERROR, WARNING) –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ
- –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞: –∫—Ä–∞—Å–Ω—ã–π = ERROR, –∂—ë–ª—Ç—ã–π = WARNING
- –§–∏–ª—å—Ç—Ä –ø–æ —Å–µ—Ä–≤–∏—Å—É (media / text / –æ–±–∞)
- –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –æ—à–∏–±–∫–∏ (PersistentTimestamp, Cannot resolve, FloodWait, –¥—Ä—É–≥–∏–µ)
- –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å"
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

#### 2.3. –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **‚ñ∂ Start** / **‚èπ Stop** / **üîÑ Restart** ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –æ—Ç–¥–µ–ª—å–Ω–æ (—á–µ—Ä–µ–∑ `systemctl`)
- **üîÑ Reload Cache** ‚Äî –≤—ã–∑–æ–≤ `/reload_cache` endpoint —Å–∫—Ä–∏–ø—Ç–∞ (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞)
- **üßπ Clear Flood Wait** ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞, –ø–æ–¥–æ–∂–¥–∞—Ç—å 5 –º–∏–Ω—É—Ç, –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ –æ–¥–Ω–æ–º—É —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 60 —Å–µ–∫—É–Ω–¥ (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞)
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ–ø–∞—Å–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ (Stop, Clear Flood Wait)

#### 2.4. Health-check
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥) –¥—ë—Ä–≥–∞—Ç—å `/health` endpoint –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç 3 —Ä–∞–∑–∞ –ø–æ–¥—Ä—è–¥ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–ª–µ—Ä—Ç –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ
- –ò—Å—Ç–æ—Ä–∏—è health-check –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞ (–ø—Ä–æ—Å—Ç–æ–π –≥—Ä–∞—Ñ–∏–∫ –∏–ª–∏ —Å–ø–∏—Å–æ–∫)

#### 2.5. –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- –ö–Ω–æ–ø–∫–∞ **"–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞"** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–∞–±–æ—Ä –ø—Ä–æ–≤–µ—Ä–æ–∫:
  - `systemctl status` –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤ (`ss -tlnp | grep 5022|5023`)
  - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –æ—à–∏–±–æ–∫ –∏–∑ journalctl
  - Health endpoint –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - –†–∞–∑–º–µ—Ä –∫—ç—à–∞ entity
- –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç –ø—Ä—è–º–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –¥–∞—à–±–æ—Ä–¥–∞

```
/root/monitor/
‚îú‚îÄ‚îÄ monitor_app.py          # Flask/FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ index.html          # –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∞—à–±–æ—Ä–¥–∞
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ style.css
‚îÇ   ‚îî‚îÄ‚îÄ app.js
‚îî‚îÄ‚îÄ requirements.txt
```

### Systemd-—é–Ω–∏—Ç –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞

```
/etc/systemd/system/telethon-monitor.service
```
- –ü–æ—Ä—Ç: **5099** (–∏–ª–∏ –ª—é–±–æ–π —Å–≤–æ–±–æ–¥–Ω—ã–π)
- –î–æ—Å—Ç—É–ø: —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª–∫–∞ –∏–ª–∏ –ø–æ IP —Å–µ—Ä–≤–µ—Ä–∞
- Restart=always

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ë–∞–∑–æ–≤–∞—è HTTP-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
- –ò–ª–∏ —Ö–æ—Ç—è –±—ã –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É IP

---

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã** –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –º–µ–Ω—è—Ç—å—Å—è
2. **–ü—Ä–æ–ø–∞—Ç—á–∏—Ç—å send_media —Å–∫—Ä–∏–ø—Ç** (—É–±—Ä–∞—Ç—å flood loop, –¥–æ–±–∞–≤–∏—Ç—å catch_up=False, /stats, /reload_cache)
3. **–ü—Ä–æ–ø–∞—Ç—á–∏—Ç—å send_text —Å–∫—Ä–∏–ø—Ç** (–¥–æ–±–∞–≤–∏—Ç—å –∫—ç—à, catch_up=False, —É–±—Ä–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π iter_dialogs, /stats, /reload_cache)
4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã** (—Å –ø–∞—É–∑–æ–π –º–µ–∂–¥—É –Ω–∏–º–∏)
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å** —á—Ç–æ –æ—à–∏–±–∫–∏ —É—à–ª–∏
6. **–°–æ–∑–¥–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–¥–∞—à–±–æ—Ä–¥**
7. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å systemd** –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞
8. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å** —á—Ç–æ –¥–∞—à–±–æ—Ä–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –¢–µ–∫—É—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å)

| –°–µ—Ä–≤–∏—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `circle-bot.service` | Telegram Circle Video Bot |
| `comments-parser.service` | Telegram Comments Parser |
| `telegram-create-chat.service` | Create Chat (–ø–æ—Ä—Ç 5013) |
| `telegram-leave-ivan.service` | Leave Ivan (–ø–æ—Ä—Ç 5020) |
| `telegram-send-media.service` | Send Media (–ø–æ—Ä—Ç 5014) ‚Äî –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å, –ù–ï –ï–≥–æ—Ä–∞ |
| `telegram-send-text.service` | Send Text (–ø–æ—Ä—Ç 5016) ‚Äî –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å, –ù–ï –ï–≥–æ—Ä–∞ |
| `tg-parser.service` | Telegram Job Parser |
| `video_webhook.service` | Video Webhook |

### –ê–Ω–∞–ª–æ–≥ —Ä–∞–±–æ—á–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)

–°–µ—Ä–≤–∏—Å—ã –ò–≤–∞–Ω–∞ (`telegram-send-media`, `telegram-send-text`) —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ ‚Äî —É –Ω–∏—Ö gevent –≤–æ—Ä–∫–µ—Ä, —Ç–∞–π–º–∞—É—Ç 180 —Å–µ–∫—É–Ω–¥, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ª–æ–≥–∏. –î–∞–Ω–∏–∏–ª –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª —Å–µ—Ä–≤–∏—Å—ã –ï–≥–æ—Ä–∞ –ø–æ –∏—Ö –æ–±—Ä–∞–∑—Ü—É.

### –ö–ª—é—á–µ–≤—ã–µ –¥–∞—Ç—ã

- **12.02.2026** ‚Äî –î–∞–Ω–∏–∏–ª –æ–±–Ω–∞—Ä—É–∂–∏–ª –ø—Ä–æ–±–ª–µ–º—ã —Å send_media (–º—ë—Ä—Ç–≤—ã–π) –∏ send_text (–¥–≤–∞ –º–∞—Å—Ç–µ—Ä-–ø—Ä–æ—Ü–µ—Å—Å–∞, –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ç–∞–π–º–∞—É—Ç)
- **13.02.2026** ‚Äî –î–∞–Ω–∏–∏–ª –ø–æ—Ñ–∏–∫—Å–∏–ª PersistentTimestampOutdatedError, –¥–æ–±–∞–≤–∏–ª retry —Å reconnect
- **20.02.2026** ‚Äî –ï–≥–æ—Ä —Å–æ–æ–±—â–∏–ª –æ —Ç–æ—Ç–∞–ª—å–Ω–æ–º –æ—Ç–∫–∞–∑–µ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
