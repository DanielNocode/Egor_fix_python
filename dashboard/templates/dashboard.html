<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Платформа Telethon — Панель управления</title>
    <link rel="stylesheet" href="/static/dashboard.css">
</head>
<body>
    <header>
        <h1>Панель управления</h1>
        <div class="header-right">
            <span id="last-update" class="muted"></span>
            <button onclick="refreshAll()" class="btn btn-sm">Обновить</button>
            <button onclick="restartPlatform()" class="btn btn-sm btn-red">Перезапустить</button>
        </div>
    </header>

    <!-- NOTIFICATIONS -->
    <div id="notifications"></div>

    <!-- SERVICES -->
    <section>
        <h2>Сервисы</h2>
        <div class="services-row" id="services-row"></div>
    </section>

    <!-- SUMMARY -->
    <section>
        <div class="summary-row" id="summary-row">
            <div class="summary-card">
                <div class="summary-value" id="s-healthy">-</div>
                <div class="summary-label">Аккаунты работают</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="s-chats">-</div>
                <div class="summary-label">Активных чатов</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="s-ops">-</div>
                <div class="summary-label">Всего операций</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="s-errors">-</div>
                <div class="summary-label">Ошибок</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="s-failovers">-</div>
                <div class="summary-label">Переключений</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="s-retries">-</div>
                <div class="summary-label">Ожидают повтора</div>
            </div>
        </div>
    </section>

    <!-- LOAD DISTRIBUTION -->
    <section>
        <h2>Распределение нагрузки</h2>
        <div class="load-section" id="load-section"></div>
    </section>

    <!-- ACCOUNTS -->
    <section>
        <h2>Аккаунты</h2>
        <div class="cards" id="accounts-grid"></div>
    </section>

    <!-- TABS -->
    <section class="tabs-section">
        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="chats">Чаты</button>
            <button class="tab-btn" data-tab="operations">Операции</button>
            <button class="tab-btn" data-tab="failovers">Переключения</button>
            <button class="tab-btn" data-tab="failed">Неудачные запросы</button>
            <button class="tab-btn" data-tab="logs">Системные логи</button>
        </div>

        <!-- TAB: Chats -->
        <div class="tab-content active" id="tab-chats">
            <div class="search-bar">
                <input type="text" id="search-chats" placeholder="Поиск по ID, названию, аккаунту..." oninput="filterTable('chats-tbody', this.value)">
            </div>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>ID чата</th>
                            <th>Название</th>
                            <th>Аккаунт</th>
                            <th>Создан</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody id="chats-tbody"></tbody>
                </table>
            </div>
            <div id="chats-more"></div>
        </div>

        <!-- TAB: Operations -->
        <div class="tab-content" id="tab-operations">
            <div class="search-bar">
                <input type="text" id="search-ops" placeholder="Поиск по аккаунту, чату, операции..." oninput="filterTable('ops-tbody', this.value)">
            </div>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Время</th>
                            <th>Аккаунт</th>
                            <th>Чат ID</th>
                            <th>Название</th>
                            <th>Операция</th>
                            <th>Результат</th>
                            <th>Подробности</th>
                        </tr>
                    </thead>
                    <tbody id="ops-tbody"></tbody>
                </table>
            </div>
            <div id="ops-more"></div>
        </div>

        <!-- TAB: Failovers -->
        <div class="tab-content" id="tab-failovers">
            <div class="search-bar">
                <input type="text" id="search-fo" placeholder="Поиск по чату, аккаунту..." oninput="filterTable('fo-tbody', this.value)">
            </div>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Время</th>
                            <th>Чат</th>
                            <th>С аккаунта</th>
                            <th>На аккаунт</th>
                            <th>Причина</th>
                        </tr>
                    </thead>
                    <tbody id="fo-tbody"></tbody>
                </table>
            </div>
            <div id="fo-more"></div>
        </div>

        <!-- TAB: Failed Requests -->
        <div class="tab-content" id="tab-failed">
            <div class="search-bar">
                <input type="text" id="search-failed" placeholder="Поиск по сервису, ошибке..." oninput="filterTable('failed-tbody', this.value)">
                <button onclick="refreshFailed()" class="btn btn-sm">Обновить</button>
            </div>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Время</th>
                            <th>Сервис</th>
                            <th>Направление</th>
                            <th>Ошибка</th>
                            <th>Попыток</th>
                            <th>Статус</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="failed-tbody"></tbody>
                </table>
            </div>
            <div id="failed-more"></div>
        </div>

        <!-- TAB: Logs -->
        <div class="tab-content" id="tab-logs">
            <div class="search-bar">
                <input type="text" id="search-logs" placeholder="Поиск в логах..." oninput="filterLogs(this.value)">
                <button onclick="refreshLogs()" class="btn btn-sm">Обновить логи</button>
            </div>
            <div class="logs-wrap" id="logs-wrap"></div>
            <div id="logs-more"></div>
        </div>
    </section>

    <!-- EDIT MODAL -->
    <div id="edit-modal" class="modal-overlay" style="display:none">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">Редактирование запроса</h3>
                <button onclick="closeEditModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-info">
                <span id="modal-service" class="modal-badge"></span>
                <span id="modal-direction" class="modal-badge"></span>
                <span id="modal-endpoint" class="muted"></span>
            </div>
            <div class="modal-body">
                <label for="modal-payload">JSON payload:</label>
                <textarea id="modal-payload" spellcheck="false"></textarea>
                <div id="modal-error" class="modal-error" style="display:none"></div>
            </div>
            <div class="modal-footer">
                <button onclick="savePayload()" class="btn btn-green">Сохранить</button>
                <button onclick="saveAndRetry()" class="btn btn-blue">Сохранить и повторить</button>
                <button onclick="closeEditModal()" class="btn">Отмена</button>
            </div>
        </div>
    </div>

    <script src="/static/dashboard.js"></script>
</body>
</html>
